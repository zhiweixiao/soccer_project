---
title: "soccer_project"
author: "zhiwei xiao"
date: "7/9/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message=FALSE}
library(DBI)
library(RSQLite)
library(tidyverse)
temp <- dbConnect(SQLite(), "/Users/xiaozhiwei/Downloads/database.sqlite")
as.data.frame(dbListTables(temp))
match_data <- dbReadTable(temp,"Match") %>% select(1:11)
team_id <- dbReadTable(temp,"Team") %>% select(team_api_id, team_long_name)
```



```{r}
colnames(match_data)
colnames(team_id)
match_data <- match_data %>% left_join(team_id, by = c("home_team_api_id" = "team_api_id"))
names(match_data)[12] = "home_team_name"
match_data <- match_data %>% left_join(team_id, by = c("away_team_api_id" = "team_api_id"))
names(match_data)[13] = "away_team_name"


head(match_data)
team_data %>% filter(team_api_id == 8203)
cor(match_data$home_team_goal, match_data$away_team_goal)
mean(match_data$home_team_goal)
mean(match_data$away_team_goal)
```


```{r, message=FALSE, warning=FALSE}
library(fitdistrplus)
par(mfrow=c(2,2))
fit.in1 <- fitdist(match_data$home_team_goal, "norm")
fit.in2 <- fitdist(match_data$home_team_goal, "pois")
fit.in3 <- fitdist(match_data$home_team_goal, "nbinom")

denscomp(list(fit.in1,fit.in2,fit.in3),legendtext=c("Normal","pois","nbinom"))
qqcomp(list(fit.in1,fit.in2,fit.in3),legendtext=c("Normal","pois","nbinom"))
cdfcomp(list(fit.in1,fit.in2,fit.in3),legendtext=c("Normal","pois","nbinom"))
ppcomp(list(fit.in1,fit.in2,fit.in3),legendtext=c("Normal","pois","nbinom"))
```


```{r,message=FALSE, warning=FALSE}
par(mfrow=c(2,2))
fit.in4 <- fitdist(match_data$away_team_goal, "norm")
fit.in5 <- fitdist(match_data$away_team_goal, "pois")
fit.in6 <- fitdist(match_data$away_team_goal, "nbinom")

denscomp(list(fit.in4,fit.in5,fit.in6),legendtext=c("Normal","pois","nbinom"))
qqcomp(list(fit.in4,fit.in5,fit.in6),legendtext=c("Normal","pois","nbinom"))
cdfcomp(list(fit.in4,fit.in5,fit.in6),legendtext=c("Normal","pois","nbinom"))
ppcomp(list(fit.in4,fit.in5,fit.in6),legendtext=c("Normal","pois","nbinom"))
```

```{r,message=FALSE, warning=FALSE}
model1 <- glm(home_team_goal ~ home_team_name + away_team_name, family="poisson", data=match_data)
summary(model1)
```



```{r,message=FALSE, warning=FALSE}
model2 <- glm(away_team_goal ~ home_team_name + away_team_name + home_team_goal, family="poisson", data=match_data)
summary(model2)
```

```{r}

```






