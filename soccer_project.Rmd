---
title: "soccer_project"
author: "zhiwei xiao"
date: "7/9/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message=FALSE}
library(DBI)
library(RSQLite)
library(tidyverse)
library(boot)
library(fitdistrplus)
library(qqplotr)
library(gamlss.dist)
library(extraDistr)
library(pscl)
library(VGAM)
library(iterativeBMA)
library(BMA)

temp <- dbConnect(SQLite(), "/Users/zhiweixiao/Downloads/database.sqlite")
as.data.frame(dbListTables(temp))
match_data <- dbReadTable(temp,"Match")
team_id <- dbReadTable(temp,"Team")
league_id <- dbReadTable(temp,"League")

team_id <- team_id[,c("team_api_id", "team_long_name")]
match_data <- match_data[,1:11]
league_id <- league_id[,c(1,3)]
```



```{r}
match_data <- match_data %>% left_join(team_id, by = c("home_team_api_id" = "team_api_id"))
names(match_data)[12] = "home_team_name"
match_data <- match_data %>% left_join(team_id, by = c("away_team_api_id" = "team_api_id"))
names(match_data)[13] = "away_team_name"
match_data <- match_data %>% left_join(league_id, by = c("league_id" = "id"))
names(match_data)[14] = "league_name"

head(match_data)



cor(match_data$home_team_goal, match_data$away_team_goal)
```


```{r, message=FALSE, warning=FALSE}
par(mfrow=c(2,2))
fit.in1 <- fitdist(match_data$home_team_goal, "norm")
fit.in2 <- fitdist(match_data$home_team_goal, "pois")
fit.in3 <- fitdist(match_data$home_team_goal, "nbinom")

denscomp(list(fit.in1,fit.in2,fit.in3),legendtext=c("Normal","pois","nbinom"))
qqcomp(list(fit.in1,fit.in2,fit.in3),legendtext=c("Normal","pois","nbinom"))
cdfcomp(list(fit.in1,fit.in2,fit.in3),legendtext=c("Normal","pois","nbinom"))
ppcomp(list(fit.in1,fit.in2,fit.in3),legendtext=c("Normal","pois","nbinom"))
```


```{r,message=FALSE, warning=FALSE}
par(mfrow=c(2,2))
fit.in4 <- fitdist(match_data$away_team_goal, "norm")
fit.in5 <- fitdist(match_data$away_team_goal, "pois")
fit.in6 <- fitdist(match_data$away_team_goal, "nbinom")

denscomp(list(fit.in4,fit.in5,fit.in6),legendtext=c("Normal","pois","nbinom"))
qqcomp(list(fit.in4,fit.in5,fit.in6),legendtext=c("Normal","pois","nbinom"))
cdfcomp(list(fit.in4,fit.in5,fit.in6),legendtext=c("Normal","pois","nbinom"))
ppcomp(list(fit.in4,fit.in5,fit.in6),legendtext=c("Normal","pois","nbinom"))
```



```{r}
## data is not over-dispersed
r <- c(mean(match_data$home_team_goal), var(match_data$home_team_goal))
c(mean=r[1], var=r[2], ratio=r[2]/r[1])


fit = glm(home_team_goal ~ home_team_name + away_team_name, family="poisson", data = match_data)
fit.overdisp = glm(home_team_goal ~ home_team_name + away_team_name,family="quasipoisson",data = match_data)
summary(fit.overdisp)$dispersion # dispersion coefficient
pchisq(summary(fit.overdisp)$dispersion * fit$df.residual, fit$df.residual, lower = F)
#significance for overdispersion, if less than 0.05, over-dispersion is more appropriate
```


```{r,message=FALSE, warning=FALSE}
## should not use zero-inflated model
model1 <- glm(home_team_goal ~ home_team_name + away_team_name, family="poisson", data=match_data)

zobs <- match_data$home_team_goal == 0

zpoi <- exp(-exp(predict(model1)))

c(obs=mean(zobs), poi=mean(zpoi))
```


```{r}
## reject poisson model if p-value is smaller than 0.05/8
set.seed(200)
season_2008_2009_data = filter(match_data, season == "2008/2009")
table(season_2008_2009_data$home_team_goal)
season_2008_2009_probs = dpois(0:7, lambda = mean(season_2008_2009_data$home_team_goal))
season_2008_2009_divide = season_2008_2009_probs / sum(season_2008_2009_probs)
chisq.test(x = c(762,1090,829,418,157,48,17,5), p = season_2008_2009_divide) #pass

plotdist(season_2008_2009_data$home_team_goal, "pois", para=list(lambda = mean(season_2008_2009_data$home_team_goal)))


season_2009_2010_data = filter(match_data, season == "2009/2010")
table(season_2009_2010_data$home_team_goal)
season_2009_2010_probs = dpois(0:9, lambda = mean(season_2009_2010_data$home_team_goal))
season_2009_2010_divide = season_2009_2010_probs/sum(season_2009_2010_probs)
chisq.test(x = as.numeric(table(season_2009_2010_data$home_team_goal)), p = season_2009_2010_divide) # not pass

plotdist(season_2009_2010_data$home_team_goal, "pois", para=list(lambda = mean(season_2009_2010_data$home_team_goal)))


season_2010_2011_data = filter(match_data, season == "2010/2011")
table(season_2010_2011_data$home_team_goal)
season_2010_2011_probs = dpois(0:10, lambda = mean(season_2010_2011_data$home_team_goal))
season_2010_2011_divide = season_2010_2011_probs/sum(season_2010_2011_probs)
chisq.test(x = c(710,1082,812,408,162,60,18,5,1,1,1), p = season_2010_2011_divide) # not pass


season_2011_2012_data = filter(match_data, season == "2011/2012")
table(season_2011_2012_data$home_team_goal)
season_2011_2012_probs = dpois(0:8, lambda = mean(season_2011_2012_data$home_team_goal))
season_2011_2012_divide = season_2011_2012_probs/sum(season_2011_2012_probs)
chisq.test(x = c(752,1000,765,411,200,62,21,7,2), p = season_2011_2012_divide) # not pass


season_2012_2013_data = filter(match_data, season == "2012/2013")
table(season_2012_2013_data$home_team_goal)
season_2012_2013_probs = dpois(0:9, lambda = mean(season_2012_2013_data$home_team_goal))
season_2012_2013_divide = season_2012_2013_probs/sum(season_2012_2013_probs)
chisq.test(x = c(742,1033,812,406,187,57,19,2,1,1), p = season_2012_2013_divide) # pass



season_2013_2014_data = filter(match_data, season == "2013/2014")
dim(season_2013_2014_data)
table(season_2013_2014_data$home_team_goal)
season_2013_2014_probs = dpois(0:7, lambda = mean(season_2013_2014_data$home_team_goal))
season_2013_2014_divide = season_2013_2014_probs/sum(season_2013_2014_probs)
chisq.test(x = c(675,956,737,401,189,51,18,5), p = season_2013_2014_divide) # pass


season_2014_2015_data = filter(match_data, season == "2014/2015")
table(season_2014_2015_data$home_team_goal)
season_2014_2015_probs = dpois(0:9, lambda = mean(season_2014_2015_data$home_team_goal))
season_2014_2015_divide = season_2014_2015_probs/sum(season_2014_2015_probs)
chisq.test(x = c(767,1091,804,425,153,51,28,3,2,1), p = season_2014_2015_divide) # not pass

season_2015_2016_data = filter(match_data, season == "2015/2016")
table(season_2015_2016_data$home_team_goal)
season_2015_2016_probs = dpois(c(0,1,2,3,4,5,6,7,8,10), lambda = mean(season_2015_2016_data$home_team_goal))
season_2015_2016_divide = season_2015_2016_probs/sum(season_2015_2016_probs)
chisq.test(x = c(774,1059,808,429,149,75,26,4,1,1), p = season_2015_2016_divide) # not pass
```


```{r}
set.seed(200)
table(season_2008_2009_data$away_team_goal)
season_2008_2009_probs_away = dpois(0:7, lambda = mean(season_2008_2009_data$away_team_goal))
season_2008_2009_divide_away = season_2008_2009_probs_away / sum(season_2008_2009_probs_away)
chisq.test(x = c(1178,1141,636,266,78,21,5,1), p = season_2008_2009_divide_away) # pass


table(season_2009_2010_data$away_team_goal)
season_2009_2010_probs_away = dpois(0:7, lambda = mean(season_2009_2010_data$away_team_goal))
season_2009_2010_divide_away = season_2009_2010_probs_away/sum(season_2009_2010_probs_away)
chisq.test(x = c(1126,1107,620,248,90,32,6,1), p = season_2009_2010_divide_away) # not pass


table(season_2010_2011_data$away_team_goal)
season_2010_2011_probs_away = dpois(0:8, lambda = mean(season_2010_2011_data$away_team_goal))
season_2010_2011_divide_away = season_2010_2011_probs_away/sum(season_2010_2011_probs_away)
chisq.test(x = c(1111,1129,646,258,88,19,6,1,2), p = season_2010_2011_divide_away) # not pass


table(season_2011_2012_data$away_team_goal)
season_2011_2012_probs_away = dpois(0:7, lambda = mean(season_2011_2012_data$away_team_goal))
season_2011_2012_divide_away = season_2011_2012_probs_away/sum(season_2011_2012_probs_away)
chisq.test(x = c(1107,1107,626,252,86,29,12,1), p = season_2011_2012_divide_away) # not pass



table(season_2012_2013_data$away_team_goal)
season_2012_2013_probs_away = dpois(0:7, lambda = mean(season_2012_2013_data$away_team_goal))
season_2012_2013_divide_away = season_2012_2013_probs_away/sum(season_2012_2013_probs_away)
chisq.test(x = c(1017,1133,678,287,103,29,12,1), p = season_2012_2013_divide_away) # not pass



table(season_2013_2014_data$away_team_goal)
season_2013_2014_probs_away = dpois(0:7, lambda = mean(season_2013_2014_data$away_team_goal))
season_2013_2014_divide_away = season_2013_2014_probs_away/sum(season_2013_2014_probs_away)
chisq.test(x = c(994,1035,611,270,84,31,5,2), p = season_2013_2014_divide_away) # not pass


table(season_2014_2015_data$away_team_goal)
season_2014_2015_probs_away = dpois(0:8, lambda = mean(season_2014_2015_data$away_team_goal))
season_2014_2015_divide_away = season_2014_2015_probs_away/sum(season_2014_2015_probs_away)
chisq.test(x = c(1127,1135,666,272,84,29,8,2,2), p = season_2014_2015_divide_away) # not pass


table(season_2015_2016_data$away_team_goal)
season_2015_2016_probs_away = dpois(0:9, lambda = mean(season_2015_2016_data$away_team_goal))
season_2015_2016_divide_away = season_2015_2016_probs_away/sum(season_2015_2016_probs_away)
chisq.test(x = c(1027,1202,663,292,105,25,9,1,1,1), p = season_2015_2016_divide_away) # not pass
```


```{r}
Belgium_data = subset(match_data, league_name == "Belgium Jupiler League" & season == "2015/2016")
England_data = subset(match_data, league_name == "England Premier League"& season == "2015/2016")
dim(England_data)
France_data = subset(match_data, league_name == "France Ligue 1" & season == "2015/2016")
Germany_data = subset(match_data, league_name == "Germany 1. Bundesliga" & season == "2015/2016")
Italy_data = subset(match_data, league_name == "Italy Serie A" & season == "2015/2016")
Netherland_data = subset(match_data, league_name == "Netherlands Eredivisie" & season == "2015/2016")
Poland_data = subset(match_data, league_name == "Poland Ekstraklasa" & season == "2015/2016")
Portugal_data = subset(match_data, league_name == "Portugal Liga ZON Sagres" & season == "2015/2016")
Scotland_data = subset(match_data, league_name == "Scotland Premier League" & season == "2015/2016")
Spain_data = subset(match_data, league_name == "Spain LIGA BBVA" & season == "2015/2016")
Switzerland_data = subset(match_data, league_name == "Switzerland Super League" & season == "2015/2016")
```




```{r, warning=FALSE}
## the higher values for the home team, the higher their offensive strength. the lower values for the away team, the higher their defensive strength.
a = Belgium_data$home_team_goal
Belgium_data_fit_poisson = fitdistr(a, densfun = "poisson")
Belgium_data_fit_poisson$loglik # pick
Belgium_data_fit_nb = fitdistr(a, densfun = "Negative Binomial")
Belgium_data_fit_nb$loglik
#Belgium_data_fit_zip <- fitdist(a, distr = 'zip',start = list(lambda=mean(a),pi=sum(a == 0)/length(a)))
#Belgium_data_fit_zip$loglik
Belgium_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = Belgium_data)
Belgium_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = Belgium_data)
Belgium_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data =Belgium_data)


Belgium_test_sets = expand.grid(home_team_name = Belgium_data$home_team_name, away_team_name = Belgium_data$away_team_name)
predict(Belgium_poisson_model, newdata = Belgium_test_sets[1,], type = "response")

```






```{r, warning=FALSE}
b = England_data$home_team_goal
England_data_fit_poisson = fitdistr(b, densfun = "poisson")
England_data_fit_poisson$loglik
England_data_fit_nb = fitdistr(b, densfun = "Negative Binomial")
England_data_fit_nb$loglik
England_data_fit_zip <- fitdist(b, distr = 'zip',start = list(lambda=mean(b),pi=sum(b == 0)/length(b)))
England_data_fit_zip$loglik # pick
England_poisson_model_home <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = England_data)
England_poisson_model_away <- glm(away_team_goal ~ home_team_name + away_team_name, family = "poisson", data = England_data)
England_nb_model_home <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = England_data)
England_nb_model_away <- glm.nb(away_team_goal ~ home_team_name + away_team_name, data = England_data)
England_zip_model_home <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data = England_data)
England_zip_model_away <- zeroinfl(away_team_goal ~ home_team_name + away_team_name, data = England_data)



set.seed(22)
vector_1 = rep(0, 380)
vector_2 = rep(0, 380)
for(i in 1:380){
England_home_predict_poisson = rpois(n = 500,  lambda = predict(England_poisson_model_home, England_data[i,], type = "response"))
England_away_predict_poisson = rpois(n = 500,  lambda = predict(England_poisson_model_away, England_data[i,], type = "response"))
vector_1[i] = sum(England_home_predict_poisson > England_away_predict_poisson) / 500
vector_2[i] = ifelse(England_data[i,]$home_team_goal > England_data[i,]$away_team_goal, 1, 0)
}
sum((vector_1 - vector_2)^2) / 380



vector_3 = rep(0, 380)
for(i in 1:380){
England_home_predict_nb = rnbinom(n = 500,  size = England_nb_model_home$theta,
                                              mu = predict(England_nb_model_home, England_data[i,], type = "response"))
England_away_predict_nb = rnbinom(n = 500,  size = England_nb_model_away$theta,
                                              mu = predict(England_nb_model_away, England_data[i,], type = "response"))
vector_3[i] = sum(England_home_predict_nb > England_away_predict_nb) / 500
}
sum((vector_3 - vector_2)^2) / 380



vector_4 = rep(0, 380)
for(i in 1:380){
England_home_predict_zip = rzipois(n = 500, lambda = predict(England_zip_model_home,England_data[i,],type = "count"), 
                                               pstr0 = predict(England_zip_model_home,England_data[i,],type = "zero"))
England_away_predict_zip = rzipois(n = 500, lambda = predict(England_zip_model_away,England_data[i,],type = "count"), 
                                               pstr0 = predict(England_zip_model_away,England_data[i,],type = "zero"))
vector_4[i] = sum(England_home_predict_zip > England_away_predict_zip) / 500
}
sum((vector_4 - vector_2)^2) / 380
```


```{r, warning = FALSE}
c = France_data$home_team_goal
France_data_fit_poisson = fitdistr(c, densfun = "poisson")
France_data_fit_poisson$loglik
France_data_fit_nb = fitdistr(c, densfun = "Negative Binomial")
France_data_fit_nb$loglik # pick
France_data_fit_zip <- fitdist(c, distr = 'zip',start = list(lambda=mean(c),pi=sum(c == 0)/length(c)))
France_data_fit_zip$loglik
France_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = France_data)
France_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = France_data)
France_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data = France_data)



d = Germany_data$home_team_goal
Germany_data_fit_poisson = fitdistr(d, densfun = "poisson")
Germany_data_fit_poisson$loglik
Germany_data_fit_nb = fitdistr(d, densfun = "Negative Binomial")
Germany_data_fit_nb$loglik # pick
Germany_data_fit_zip <- fitdist(d, distr = 'zip',start = list(lambda=mean(d),pi=sum(d == 0)/length(d)))
Germany_data_fit_zip$loglik
Germany_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = Germany_data)
Germany_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = Germany_data)
Germany_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data = Germany_data)




e = Italy_data$home_team_goal
Italy_data_fit_poisson = fitdistr(e, densfun = "poisson")
Italy_data_fit_poisson$loglik
Italy_data_fit_nb = fitdistr(e, densfun = "Negative Binomial")
Italy_data_fit_nb$loglik
Italy_data_fit_zip <- fitdist(e, distr = 'zip',start = list(lambda=mean(e),pi=sum(e == 0)/length(e)))
Italy_data_fit_zip$loglik # pick
Italy_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = Italy_data)
Italy_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = Italy_data)
Italy_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data = Italy_data)





f = Netherland_data$home_team_goal
Netherland_data_fit_poisson = fitdistr(f, densfun = "poisson")
Netherland_data_fit_poisson$loglik
Netherland_data_fit_nb = fitdistr(f, densfun = "Negative Binomial")
Netherland_data_fit_nb$loglik
Netherland_data_fit_zip <- fitdist(f, distr = 'zip',start = list(lambda=mean(f),pi=sum(f == 0)/length(f)))
Netherland_data_fit_zip$loglik # pick
Netherland_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = Netherland_data)
Netherland_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = Netherland_data)
Netherland_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data = Netherland_data)




g = Poland_data$home_team_goal
Poland_data_fit_poisson = fitdistr(g, densfun = "poisson")
Poland_data_fit_poisson$loglik
Poland_data_fit_nb = fitdistr(g, densfun = "Negative Binomial")
Poland_data_fit_nb$loglik # pick
Poland_data_fit_zip <- fitdist(g, distr = 'zip',start = list(lambda=mean(g),pi=sum(g == 0)/length(g)))
Poland_data_fit_zip$loglik
Poland_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = Poland_data)
Poland_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = Poland_data)
Poland_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data = Poland_data)



h = Portugal_data$home_team_goal
Portugal_data_fit_poisson = fitdistr(h, densfun = "poisson")
Portugal_data_fit_poisson$loglik
Portugal_data_fit_nb = fitdistr(h, densfun = "Negative Binomial")
Portugal_data_fit_nb$loglik # pick
Portugal_data_fit_zip <- fitdist(h, distr = 'zip',start = list(lambda=mean(h),pi=sum(h == 0)/length(h)))
Portugal_data_fit_zip$loglik
Portugal_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = Portugal_data)
Portugal_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = Portugal_data)
Poland_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data = Portugal_data)



i = Scotland_data$home_team_goal
Scotland_data_fit_poisson = fitdistr(i, densfun = "poisson")
Scotland_data_fit_poisson$loglik
Scotland_data_fit_nb = fitdistr(i, densfun = "Negative Binomial")
Scotland_data_fit_nb$loglik # pick
Scotland_data_fit_zip <- fitdist(i, distr = 'zip',start = list(lambda=mean(i),pi=sum(i == 0)/length(i)))
Scotland_data_fit_zip$loglik
Scotland_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = Scotland_data)
Scotland_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = Scotland_data)
Scotland_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data = Scotland_data)



j = Spain_data$home_team_goal
Spain_data_fit_poisson = fitdistr(j, densfun = "poisson")
Spain_data_fit_poisson$loglik
Spain_data_fit_nb = fitdistr(j, densfun = "Negative Binomial")
Spain_data_fit_nb$loglik # pick
Spain_data_fit_zip <- fitdist(j, distr = 'zip',start = list(lambda=mean(j),pi=sum(j == 0)/length(j)))
Spain_data_fit_zip$loglik
Spain_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", data = Spain_data)
Spain_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, data = Spain_data)
Spain_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, data = Spain_data)




k = Switzerland_data$home_team_goal
Switzerland_data_fit_poisson = fitdistr(k, densfun = "poisson")
table(Switzerland_data$stage)
Switzerland_data_fit_poisson$loglik
Switzerland_data_fit_nb = fitdistr(k, densfun = "Negative Binomial")
Switzerland_data_fit_nb$loglik
Switzerland_data_fit_zip <- fitdist(k, distr = 'zip',start = list(lambda=mean(k),pi=sum(k == 0)/length(k)))
Switzerland_data_fit_zip$loglik # pick
Switzerland_zero_inflated_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name, 
                                                    data = subset(Switzerland_data, stage %in% 1:10))


## generate simulated zip data, and then fit zinb. done. not ideal
```




```{r}
## coefficients for poisson and negative binomial are exteremely close to each other
all_models_England <- dplyr::bind_rows(
  data.frame(coef = England_zero_inflated_poisson_model$coefficients$count, teams = names(England_zero_inflated_poisson_model$coefficients$count), model = "zip"),
  data.frame(coef = England_poisson_model$coefficients, teams = names(England_poisson_model$coefficients), model = "poisson"),
  data.frame(coef = England_nb_model$coefficients, teams = names(England_nb_model$coefficients), model = "negbin"))

ggplot(all_models_England, aes(x = teams, y = coef, color = model))+geom_point()+coord_flip()
```






```{r, warning=FALSE}
Belgium_mse_poisson = rep(NA, 30)
for (i in 5:29) {
  Belgium_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson", 
                             data = subset(Belgium_data, stage %in% c(1:i)))
  Belgium_poisson_model_prediction <- predict(Belgium_poisson_model, subset(Belgium_data, stage == i+1))
  print(Belgium_poisson_model_prediction)
  Belgium_mse_poisson[i+1] = mean((Belgium_poisson_model_prediction - subset(Belgium_data, stage == i+1)$home_team_goal)^2)
}
Belgium_mse_poisson


Belgium_mse_nb = rep(NA, 30)
for (i in 5:29) {
  Belgium_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name,
                             data = subset(Belgium_data, stage %in% c(1:i)))
  Belgium_nb_model_prediction <- predict(Belgium_nb_model, subset(Belgium_data, stage == i+1))
  Belgium_mse_nb[i+1] = mean((Belgium_nb_model_prediction - subset(Belgium_data, stage == i+1)$home_team_goal)^2)
}
Belgium_mse_nb


Belgium_mse_zero_poisson = rep(NA, 30)
for (i in 5:29) {
Belgium_zero_poisson_model <- zeroinfl(home_team_goal ~ home_team_name + away_team_name,
                             data = subset(Belgium_data, stage %in% c(1:i)))
Belgium_zero_poisson_model_prediction <- predict(Belgium_zero_poisson_model, subset(Belgium_data, stage == i+1))
Belgium_mse_zero_poisson[i+1] = mean((Belgium_zero_poisson_model_prediction - subset(Belgium_data, stage == i+1)$home_team_goal)^2)
print(Belgium_zero_poisson_model_prediction)
}
Belgium_mse_zero_poisson






England_mse_nb = rep(NA,38)
for (i in 4:37) {
  England_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(England_data, stage %in% c(1:i)))
  England_nb_model_prediction <- predict(England_nb_model, subset(England_data, stage == i+1))
  England_mse_nb[i] = mean((England_nb_model_prediction - subset(England_data, stage == i+1)$home_team_goal)^2)
}
print(England_mse_nb)


England_mse_poisson = rep(NA,38)
for (i in 4:37) {
  England_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(England_data, stage %in% c(1:i)))
  England_poisson_model_prediction <- predict(England_poisson_model, subset(England_data, stage == i+1))
  England_mse_poisson[i] = mean((England_poisson_model_prediction - subset(England_data, stage == i+1)$home_team_goal)^2)
}
print(England_mse_poisson)







sum(England_mse_nb < England_mse_poisson, na.rm = TRUE)

```


```{r ,warning=FALSE}
France_mse_nb = rep(NA,38)
for (i in 4:37) {
  France_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(France_data, stage %in% c(1:i)))
  France_nb_model_prediction <- predict(France_nb_model, subset(France_data, stage == i+1))
  France_mse_nb[i] = mean((France_nb_model_prediction - subset(France_data, stage == i+1)$home_team_goal)^2)
}


France_mse_poisson = rep(NA,38)
for (i in 4:37) {
  France_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(France_data, stage %in% c(1:i)))
  France_poisson_model_prediction <- predict(France_poisson_model, subset(France_data, stage == i+1))
  France_mse_poisson[i] = mean((France_poisson_model_prediction - subset(France_data, stage == i+1)$home_team_goal)^2)
}

```

```{r,warning=FALSE}
Germany_mse_nb = rep(NA,34)
for (i in 4:33) {
  Germany_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(Germany_data, stage %in% c(1:i)))
  Germany_nb_model_prediction <- predict(Germany_nb_model, subset(Germany_data, stage == i+1))
  Germany_mse_nb[i] = mean((Germany_nb_model_prediction - subset(Germany_data, stage == i+1)$home_team_goal)^2)
}


Germany_mse_poisson = rep(NA,34)
for (i in 4:33) {
  Germany_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(Germany_data, stage %in% c(1:i)))
  Germany_poisson_model_prediction <- predict(Germany_poisson_model, subset(Germany_data, stage == i+1))
  Germany_mse_poisson[i] = mean((Germany_poisson_model_prediction - subset(Germany_data, stage == i+1)$home_team_goal)^2)
}



Italy_mse_nb = rep(NA,38)
for (i in 4:37) {
  Italy_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(Italy_data, stage %in% c(1:i)))
  Italy_nb_model_prediction <- predict(Italy_nb_model, subset(Italy_data, stage == i+1))
  Italy_mse_nb[i] = mean((Italy_nb_model_prediction - subset(Italy_data, stage == i+1)$home_team_goal)^2)
}


Italy_mse_poisson = rep(NA,38)
for (i in 4:37) {
  Italy_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(Italy_data, stage %in% c(1:i)))
  Italy_poisson_model_prediction <- predict(Italy_poisson_model, subset(Italy_data, stage == i+1))
  Italy_mse_poisson[i] = mean((Italy_poisson_model_prediction - subset(Italy_data, stage == i+1)$home_team_goal)^2)
}


Netherland_mse_nb = rep(NA,34)
for (i in 4:33) {
  Netherland_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(Netherland_data, stage %in% c(1:i)))
  Netherland_nb_model_prediction <- predict(Netherland_nb_model, subset(Netherland_data, stage == i+1))
  Netherland_mse_nb[i] = mean((Netherland_nb_model_prediction - subset(Netherland_data, stage == i+1)$home_team_goal)^2)
}


Netherland_mse_poisson = rep(NA,34)
for (i in 4:33) {
  Netherland_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(Netherland_data, stage %in% c(1:i)))
  Netherland_poisson_model_prediction <- predict(Netherland_poisson_model, subset(Netherland_data, stage == i+1))
  Netherland_mse_poisson[i] = mean((Netherland_poisson_model_prediction - subset(Netherland_data, stage == i+1)$home_team_goal)^2)
}



Poland_mse_nb = rep(NA,30)
for (i in 4:29) {
  Poland_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(Poland_data, stage %in% c(1:i)))
  Poland_nb_model_prediction <- predict(Poland_nb_model, subset(Poland_data, stage == i+1))
  Poland_mse_nb[i] = mean((Poland_nb_model_prediction - subset(Poland_data, stage == i+1)$home_team_goal)^2)
}


Poland_mse_poisson = rep(NA,30)
for (i in 4:29) {
  Poland_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(Poland_data, stage %in% c(1:i)))
  Poland_poisson_model_prediction <- predict(Poland_poisson_model, subset(Poland_data, stage == i+1))
  Poland_mse_poisson[i] = mean((Poland_poisson_model_prediction - subset(Poland_data, stage == i+1)$home_team_goal)^2)
}


Portugal_mse_nb = rep(NA,34)
for (i in 4:33) {
  Portugal_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(Portugal_data, stage %in% c(1:i)))
  Portugal_nb_model_prediction <- predict(Portugal_nb_model, subset(Portugal_data, stage == i+1))
  Portugal_mse_nb[i] = mean((Portugal_nb_model_prediction - subset(Portugal_data, stage == i+1)$home_team_goal)^2)
}


Portugal_mse_poisson = rep(NA,34)
for (i in 4:33) {
  Portugal_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(Portugal_data, stage %in% c(1:i)))
  Portugal_poisson_model_prediction <- predict(Portugal_poisson_model, subset(Portugal_data, stage == i+1))
  Portugal_mse_poisson[i] = mean((Portugal_poisson_model_prediction - subset(Portugal_data, stage == i+1)$home_team_goal)^2)
}


Scotland_mse_nb = rep(NA,38)
for (i in 4:37) {
  Scotland_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(Scotland_data, stage %in% c(1:i)))
  Scotland_nb_model_prediction <- predict(Scotland_nb_model, subset(Scotland_data, stage == i+1))
  Scotland_mse_nb[i] = mean((Scotland_nb_model_prediction - subset(Scotland_data, stage == i+1)$home_team_goal)^2)
}


Scotland_mse_poisson = rep(NA,38)
for (i in 4:37) {
  Scotland_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(Scotland_data, stage %in% c(1:i)))
  Scotland_poisson_model_prediction <- predict(Scotland_poisson_model, subset(Scotland_data, stage == i+1))
  Scotland_mse_poisson[i] = mean((Scotland_poisson_model_prediction - subset(Scotland_data, stage == i+1)$home_team_goal)^2)
}


Spain_mse_nb = rep(NA,38)
for (i in 4:37) {
  Spain_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(Spain_data, stage %in% c(1:i)))
  Spain_nb_model_prediction <- predict(Spain_nb_model, subset(Spain_data, stage == i+1))
  Spain_mse_nb[i] = mean((Spain_nb_model_prediction - subset(Spain_data, stage == i+1)$home_team_goal)^2)
}


Spain_mse_poisson = rep(NA,38)
for (i in 4:37) {
  Spain_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(Spain_data, stage %in% c(1:i)))
  Spain_poisson_model_prediction <- predict(Spain_poisson_model, subset(Spain_data, stage == i+1))
  Spain_mse_poisson[i] = mean((Spain_poisson_model_prediction - subset(Spain_data, stage == i+1)$home_team_goal)^2)
}



Switzerland_mse_nb = rep(NA,36)
for (i in 4:35) {
  Switzerland_nb_model <- glm.nb(home_team_goal ~ home_team_name + away_team_name, 
                             data = subset(Switzerland_data, stage %in% c(1:i)))
  Switzerland_nb_model_prediction <- predict(Switzerland_nb_model, subset(Switzerland_data, stage == i+1))
  Switzerland_mse_nb[i] = mean((Switzerland_nb_model_prediction - subset(Switzerland_data, stage == i+1)$home_team_goal)^2)
}


Switzerland_mse_poisson = rep(NA,36)
for (i in 4:35) {
  Switzerland_poisson_model <- glm(home_team_goal ~ home_team_name + away_team_name, family = "poisson",
                             data = subset(Switzerland_data, stage %in% c(1:i)))
  Switzerland_poisson_model_prediction <- predict(Switzerland_poisson_model, subset(Switzerland_data, stage == i+1))
  Switzerland_mse_poisson[i] = mean((Switzerland_poisson_model_prediction - subset(Switzerland_data, stage == i+1)$home_team_goal)^2)
}

```











